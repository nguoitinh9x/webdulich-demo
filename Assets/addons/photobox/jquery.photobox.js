!function(e,t,o){"use strict";var i,n,s,a,r,l,h,c,u,d,p,f,m,v,g,b,w,y,A,C,x,T,k,L,M,H,D,O,E,z,P,S,F,X,B,I,N=[],R=-1,Y=!("placeholder"in t.createElement("input")),j=((M=e("<p>")[0]).style.cssText="pointer-events:auto",!M.style.pointerEvents),q=!1,W=e(),_="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",U=ie("transformOrigin"),Q=ie("transition"),K="transitionend webkitTransitionEnd oTransitionEnd otransitionend",G=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},Z={},J=new Image,V=new Image,$={single:!1,beforeShow:null,afterClose:null,loop:!0,thumb:null,thumbs:!0,thumbAttr:"data-src",counter:"(A/B)",title:!0,autoplay:!1,time:3e3,history:!1,hideFlash:!0,zoomable:!0,wheelNextPrev:!0,keys:{close:[27,88,67],prev:[37,80],next:[39,78]}},ee=e('<div id="pbOverlay">').append(y=e('<input type="checkbox" id="pbThumbsToggler" checked hidden>'),x=e('<div class="pbLoader"><b></b><b></b><b></b></div>'),b=e('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",ae),w=e('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",ae),L=e('<div class="pbWrapper">').append(v=e("<img>"),g=e("<div>")),e('<div id="pbCloseBtn">').on("click",we)[0],T=e('<div id="pbAutoplayBtn">').append(e('<div class="pbProgress">')),A=e('<div id="pbCaption">').append('<label for="pbThumbsToggler" title="thumbnails on/off"></label>',C=e('<div class="pbCaptionText">').append('<div class="title"></div><div class="counter">'),k=e("<div>").addClass("pbThumbs")));function te(){j&&ee.hide(),e(t).on("touchstart.testMouse",function(){e(t).off("touchstart.testMouse"),q=!0,ee.addClass("mobile")}),T.off().on("click",f.toggle),k.off().on("click","a",d.click),Y&&ee.addClass("msie"),ee.off().on("click","img",function(e){e.stopPropagation()}),e(t.body).append(ee),p=t.documentElement}function oe(e,t,o){1==t?(v.css({transform:"translateX(25%)",transition:".2s",opacity:0}),setTimeout(function(){m(c)},200)):-1==t&&(v.css({transform:"translateX(-25%)",transition:".2s",opacity:0}),setTimeout(function(){m(u)},200)),1==o?y.prop("checked",!0):-1==o&&y.prop("checked",!1)}function ie(e){var o,i=t.createElement("p").style,n=["ms","O","Moz","Webkit"];if(""==i[e])return e;for(e=e.charAt(0).toUpperCase()+e.slice(1),o=n.length;o--;)if(""==i[n[o]+e])return n[o]+e}function ne(t){var o=t.keyCode,i=s.keys;return e.inArray(o,i.close)>=0&&we()||e.inArray(o,i.next)>=0&&!s.single&&re(u)||e.inArray(o,i.prev)>=0&&!s.single&&re(c)||!0}function se(e,t,o){1==o?re(u):-1==o&&re(c)}function ae(){return re("pbPrevBtn"==this.id?c:u),!1}function re(e){if(!s.loop&&(R==N.length-1&&e==u||0==R&&e==c))return;m(e)}function le(){if(C.off(K).removeClass("change"),s.counter){try{var e=s.counter.replace("A",R+1).replace("B",N.length)}catch(e){s.counter="(A/B)",le()}A.find(".counter").text(e)}s.title&&A.find(".title").html("<span>"+N[R][1]+"</span>")}e.fn.photobox=function(t,o,s){return this.each(function(){var a,r=e(this).data("_photobox");return r?("destroy"===t&&r.destroy(),this):("string"!=typeof t&&(t="a"),"prepareDOM"===t?(te(),this):(a=e.extend({},$,o||{}),n=new i(a,this,t),e(this).data("_photobox",n),void(n.callback=s)))})},(i=function(o,i,n){this.options=e.extend({},o),this.target=n,this.selector=e(i||t),this.thumbsList=null;var s=this.imageLinksFilter(this.selector.find(n));this.imageLinks=s[0],this.images=s[1],this.init()}).prototype={init:function(){var e=this;this.selector.one("mouseenter.photobox",this.target,function(t){e.thumbsList=d.generate.apply(e)}),this.selector.on("click.photobox",this.target,function(t){t.preventDefault(),e.open(this)}),this.observerTimeout=null,Y||1!=this.selector[0].nodeType||this.observeDOM(this.selector[0],this.onDOMchanges.bind(this))},onDOMchanges:function(){var e=this;clearTimeout(this.observerTimeout),e.observerTimeout=setTimeout(function(){var t,o=e.imageLinksFilter(e.selector.find(e.target)),i=0;if(e.imageLinks.length!=o[0].length){if(e.imageLinks=o[0],e.images=o[1],n&&e.selector==n.selector)for(N=e.images,a=e.imageLinks,t=N.length;t--;)N[t][0]==r&&!0;e.thumbsList=d.generate.apply(e),k.html(e.thumbsList),e.images.length&&r&&e.options.thumbs&&(-1==(i=e.thumbsList.find('a[href="'+r+'"]').eq(0).parent().index())&&(i=0),d.changeActive(i,0))}},50)},open:function(t){var o=e.inArray(t,this.imageLinks);return-1!=o&&(s=this.options,N=this.images,a=this.imageLinks,n=this,this.setup(1),ee.on(K,function(){ee.off(K).addClass("on"),m(o,!0)}).addClass("show"),Y&&ee.trigger("MSTransitionEnd"),!1)},imageLinksFilter:function(t){var o,i=this,n=[],s={};return[t.filter(function(t){var a,r=e(this),l="";return s.content=r[0].getAttribute("title")||"",i.options.thumb&&(a=r.find(i.options.thumb)[0]),i.options.thumb&&a||(a=r.find("img")[0]),a&&(o=a.getAttribute("data-pb-captionlink"),l=a.getAttribute(i.options.thumbAttr)||a.getAttribute("src"),s.content=a.getAttribute("alt")||a.getAttribute("title")||""),o&&(2==(o=o.split("[")).length?(s.linkText=o[0],s.linkHref=o[1].slice(0,-1)):(s.linkText=o,s.linkHref=o),s.content+=' <a href="'+s.linkHref+'">'+s.linkText+"</a>"),n.push([r[0].href,s.content,l]),!0}),n]},observeDOM:(H=o.MutationObserver||o.WebKitMutationObserver,D=o.addEventListener,function(e,t){if(H){var o=this;new H(function(e,i){(e[0].addedNodes.length||e[0].removedNodes.length)&&t(o)}).observe(e,{childList:!0,subtree:!0})}else D&&(e.addEventListener("DOMNodeInserted",t.bind(o),!1),e.addEventListener("DOMNodeRemoved",t.bind(o),!1))}),setup:function(i){var n,a,r,l=i?"on":"off";s.thumbs&&(q||k[l]("mouseenter.photobox",d.calc)[l]("mousemove.photobox",d.move)),i?(v.css({transition:"0s"}).removeAttr("style"),ee.show(),k.html(this.thumbsList).trigger("mouseenter.photobox"),s.thumbs?ee.addClass("thumbs"):(y.prop("checked",!1),ee.removeClass("thumbs")),this.images.length<2||s.single?ee.removeClass("thumbs hasArrows hasCounter hasAutoplay"):(ee.addClass("hasArrows hasCounter"),s.time>1e3?(ee.addClass("hasAutoplay"),s.autoplay?f.progress.start():f.pause()):ee.removeClass("hasAutoplay")),s.hideFlash&&e("iframe, object, embed").css("visibility","hidden")):e(o).off("resize.photobox"),e(t).off("keydown.photobox")[l]({"keydown.photobox":ne}),q&&(ee.removeClass("hasArrows"),L[l]("swipe",oe)),s.zoomable&&(ee[l]({"mousewheel.photobox":me}),Y||k[l]({"mousewheel.photobox":ve})),!s.single&&s.wheelNextPrev&&ee[l]({"mousewheel.photobox":(n=se,a=1e3,r=!1,function(){r||(n.call(),r=!0,setTimeout(function(){r=!1},a))})})},destroy:function(){s=this.options,this.selector.off("click.photobox",this.target).removeData("_photobox"),we()}},P=0,S=0,F=0,X=0,B=null,d={generate:function(){var t,o,i,n,s,a=e("<ul>"),r=[],l=this.imageLinks.size();for(s=0;s<l;s++)i=this.imageLinks[s],(o=this.images[s][2])&&(t=this.images[s][1],n=i.rel?" class='"+i.rel+"'":"",r.push("<li"+n+'><a href="'+i.href+'"><img src="'+o+'" alt="" title="'+t+'" /></a></li>'));return a.html(r.join("")),a},click:function(t){t.preventDefault(),W.removeClass("active"),W=e(this).parent().addClass("active");var o=e(this.parentNode).index();return m(o,0,1)},changeActiveTimeout:null,changeActive:function(e,t,o){s.thumbs&&(W.index(),W.removeClass("active"),W=k.find("li").eq(e).addClass("active"),!o&&W[0]&&(clearTimeout(this.changeActiveTimeout),this.changeActiveTimeout=setTimeout(function(){var e=W[0].offsetLeft+W[0].clientWidth/2-p.clientWidth/2;t?k.delay(800):k.stop(),k.animate({scrollLeft:e},500,"swing")},200)))},calc:function(e){return E=k[0],P=E.clientWidth,S=E.scrollWidth,O=.15*P,F=k.offset().left,X=e.pageX-O-F,z=X/(P-2*O)*(S-P),k.animate({scrollLeft:z},200),clearTimeout(B),B=setTimeout(function(){B=null},200),this},move:function(e){if(!B){var t,o=e.pageX-O-F;o<0&&(o=0),t=o/(P-2*O)*(S-P),G(function(){E.scrollLeft=t})}}},f={autoPlayTimer:!1,play:function(){f.autoPlayTimer=setTimeout(function(){m(u)},s.time),f.progress.start(),T.removeClass("play"),f.setTitle("Click to stop autoplay"),s.autoplay=!0},pause:function(){clearTimeout(f.autoPlayTimer),f.progress.reset(),T.addClass("play"),f.setTitle("Click to resume autoplay"),s.autoplay=!1},progress:{reset:function(){T.find("div").removeAttr("style"),setTimeout(function(){T.removeClass("playing")},200)},start:function(){Y||T.find("div").css(Q,s.time+"ms"),T.addClass("playing")}},setTitle:function(e){e&&T.prop("title",e+" (every "+s.time/1e3+" seconds)")},toggle:function(e){e.stopPropagation(),f[s.autoplay?"pause":"play"]()}},m=function(t,o,i){if(!I){var n,p,m;if(I=setTimeout(function(){I=null},150),(!t||t<0)&&(t=0),s.loop||(w.toggleClass("pbHide",t==N.length-1),b.toggleClass("pbHide",0==t)),"function"==typeof s.beforeShow&&s.beforeShow(a[t]),ee.removeClass("error"),R>=0&&ee.addClass(t>R?"next":"prev"),l=R,R=n=t,r=N[n][0],c=(R||(s.loop?N.length:0))-1,u=(R+1)%N.length||(s.loop?0:-1),be(),g.empty(),Z.onerror=null,v.add(g).data("zoom",1),"video"==(h="video"==a[t].rel?"video":"image"))g.html((p=N[R][0],m=e("<a>").prop("href",N[R][0])[0].search?"&":"?",p+=m+"vq=hd720&wmode=opaque",e("<iframe>").prop({scrolling:"no",frameborder:0,allowTransparency:!0,src:p}).attr({webkitAllowFullScreen:!0,mozallowfullscreen:!0,allowFullScreen:!0}))).addClass("pbHide"),pe(o);else{var y=setTimeout(function(){ee.addClass("pbLoading")},50);Y&&ee.addClass("pbHide"),s.autoplay&&f.progress.reset(),(Z=new Image).onload=function(){Z.onload=null,c>=0&&(J.src=N[c][0]),u>=0&&(V.src=N[u][0]),clearTimeout(y),pe(o)},Z.onerror=de,Z.src=r}C.on(K,le).addClass("change"),(o||Y)&&le(),d.changeActive(t,o,i),ue.save()}};var he,ce,ue={save:function(){"pushState"in window.history&&decodeURIComponent(window.location.hash.slice(1))!=r&&s.history&&window.history.pushState("photobox",t.title+"-"+N[R][1],window.location.pathname+window.location.search+"#"+encodeURIComponent(r))},load:function(){if(s&&!s.history)return!1;var t=decodeURIComponent(window.location.hash.slice(1));!t&&ee.hasClass("show")&&we(),e('a[href="'+t+'"]').trigger("click.photobox")},clear:function(){s.history&&"pushState"in window.history&&window.history.pushState("photobox",t.title,window.location.pathname+window.location.search)}};function de(){ee.addClass("error"),v[0].src=_,Z.onerror=null}function pe(e){var t,o;function i(){clearTimeout(o),t.off(K).css({transition:"none"}),ee.removeClass("video"),"video"==h?(v[0].src=_,g.addClass("prepare"),ee.addClass("video")):v.prop({src:r,class:"prepare"}),setTimeout(function(){v.add(g).removeAttr("style").removeClass("prepare"),ee.removeClass("pbHide next prev"),setTimeout(function(){v.add(g).on(K,fe),Y&&fe()},0)},50)}o=setTimeout(i,2e3),x.fadeOut(300,function(){ee.removeClass("pbLoading"),x.removeAttr("style")}),ee.addClass("pbHide"),v.add(g).removeAttr("style").removeClass("zoomable"),e||"video"!=a[l].rel?t=v:(t=g,v.addClass("prepare")),e||Y?i():t.on(K,i)}function fe(){v.add(g).off(K).addClass("zoomable"),"video"==h?g.removeClass("pbHide"):T&&s.autoplay&&f.play(),n&&"function"==typeof n.callback&&n.callback.apply(a[R])}function me(o,i,n){if(n)return!1;if("video"==h){var s=g.data("zoom")||1;if((s+=i/10)<.5)return!1;g.data("zoom",s).css({width:624*s,height:351*s})}else{s=v.data("zoom")||1;var a=v[0].getBoundingClientRect();(s+=i/10)<.1&&(s=.1),G(function(){v.data("zoom",s).css({transform:"scale("+s+")"})}),a.height>p.clientHeight||a.width>p.clientWidth?e(t).on("mousemove.photobox",ge):(e(t).off("mousemove.photobox"),v[0].style[U]="50% 50%")}return!1}function ve(e,t){e.preventDefault(),e.stopPropagation();var o,i=n.thumbsList;i.css("height",i[0].clientHeight+10*t),o=A[0].clientHeight/2,L[0].style.cssText="margin-top: -"+o+"px; padding: "+o+"px 0;",k.hide().show(0)}function ge(e){var t=(e.clientY/p.clientHeight*(p.clientHeight+200)-100)/p.clientHeight*100,o=(e.clientX/p.clientWidth*100).toFixed(2)+"% "+t.toFixed(2)+"%";G(function(){v[0].style[U]=o})}function be(){clearTimeout(f.autoPlayTimer),e(t).off("mousemove.photobox"),Z.onload=function(){},Z.src=J.src=V.src=r}function we(){if(!ee.hasClass("show"))return!1;function t(){""!=ee[0].className&&(ee.removeClass("show pbHide error pbLoading"),v.removeAttr("class").removeAttr("style").off().data("zoom",1),v[0].src=_,A.find(".title").empty(),j&&setTimeout(function(){ee.hide()},200),s.hideFlash&&e("iframe, object, embed").css("visibility","visible"))}be(),g.find("iframe").prop("src","").empty(),i.prototype.setup(),ue.clear(),ee.removeClass("on video").addClass("pbHide"),R=-1,v.on(K,t),Y&&t(),setTimeout(function(){n=null},1e3),setTimeout(t,500),"function"==typeof s.afterClose&&s.afterClose(ee)}window.onpopstate=(he=window.onpopstate,function(e){he&&he.apply(this,arguments),"photobox"==e.state&&ue.load()}),e.event.special.swipe={setup:function(){e(this).bind("touchstart",e.event.special.swipe.handler)},teardown:function(){e(this).unbind("touchstart",e.event.special.swipe.handler)},handler:function(t){var o,i,n=[].slice.call(arguments,1),s=t.originalEvent.touches,a=0,r=0,l=this;function h(){l.removeEventListener("touchmove",c),o=i=null}function c(s){s.preventDefault();var c=o-s.touches[0].pageX,u=i-s.touches[0].pageY;return Math.abs(c)>=20?(h(),a=c>0?-1:1):Math.abs(u)>=20&&(h(),r=u>0?1:-1),t.type="swipe",n.unshift(t,a,r),(e.event.dispatch||e.event.handle).apply(l,n)}t=e.event.fix(t),1==s.length&&(o=s[0].pageX,i=s[0].pageY,this.addEventListener("touchmove",c,!1))}},ce=function(e){function t(t){var a=t||window.event,r=l.call(arguments,1),h=0,u=0,d=0,p=0,f=0,m=0;if((t=e.event.fix(a)).type="mousewheel","detail"in a&&(d=-1*a.detail),"wheelDelta"in a&&(d=a.wheelDelta),"wheelDeltaY"in a&&(d=a.wheelDeltaY),"wheelDeltaX"in a&&(u=-1*a.wheelDeltaX),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(u=-1*d,d=0),h=0===d?u:d,"deltaY"in a&&(h=d=-1*a.deltaY),"deltaX"in a&&(u=a.deltaX,0===d&&(h=-1*u)),0!==d||0!==u){if(1===a.deltaMode){var v=e.data(this,"mousewheel-line-height");h*=v,d*=v,u*=v}else if(2===a.deltaMode){var g=e.data(this,"mousewheel-page-height");h*=g,d*=g,u*=g}if(p=Math.max(Math.abs(d),Math.abs(u)),(!s||s>p)&&(s=p,i(a,p)&&(s/=40)),i(a,p)&&(h/=40,u/=40,d/=40),h=Math[h>=1?"floor":"ceil"](h/s),u=Math[u>=1?"floor":"ceil"](u/s),d=Math[d>=1?"floor":"ceil"](d/s),c.settings.normalizeOffset&&this.getBoundingClientRect){var b=this.getBoundingClientRect();f=t.clientX-b.left,m=t.clientY-b.top}return t.deltaX=u,t.deltaY=d,t.deltaFactor=s,t.offsetX=f,t.offsetY=m,t.deltaMode=0,r.unshift(t,h,u,d),n&&clearTimeout(n),n=setTimeout(o,200),(e.event.dispatch||e.event.handle).apply(this,r)}}function o(){s=null}function i(e,t){return c.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var n,s,a=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(e.event.fixHooks)for(var h=a.length;h;)e.event.fixHooks[a[--h]]=e.event.mouseHooks;var c=e.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var o=r.length;o;)this.addEventListener(r[--o],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",c.getLineHeight(this)),e.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var o=r.length;o;)this.removeEventListener(r[--o],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var o=e(t)["offsetParent"in e.fn?"offsetParent":"parent"]();return o.length||(o=e("body")),parseInt(o.css("fontSize"),10)},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})},"function"==typeof define&&define.amd?define(["jquery"],ce):"object"==typeof exports?module.exports=ce:ce(jQuery),e(t).ready(te),window._photobox={DOM:{overlay:ee},close:we,history:ue,defaults:$}}(jQuery,document,window);